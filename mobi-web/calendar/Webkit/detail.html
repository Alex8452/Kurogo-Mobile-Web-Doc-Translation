<?php

$page->title("Events: Event Details")
     ->navbar_image('calendar');

$back = isset($_REQUEST['back']) ? $_REQUEST['back'] : '';
if ($back == 'Search') {
  $page->breadcrumbs('Search', 'Detail');
  $page->breadcrumb_links('search.php?filter='.urlencode(stripslashes($_REQUEST['filter'])));
  
} else if ($back == 'Day') {
  $time = stripslashes($_REQUEST['time']);
  $type = stripslashes($_REQUEST['type']);
  
  $page->breadcrumbs('Day', "Details");
  $page->breadcrumb_links(
    'day.php?time='.urlencode($time).'&type='.urlencode($type));
    
} else if ($back == 'Category') {
  $catName = stripslashes($_REQUEST['catName']);
  $catID = stripslashes($_REQUEST['catID']);

  $page->breadcrumbs('Category', $catName, "Details");
  $page->breadcrumb_links(categorysURL(),
    'category.php?name='.urlencode($catName).'&id='.urlencode($catID).
      (isset($_REQUEST['catTime']) ? '&time='.urlencode(stripslashes($_REQUEST['catTime'])) : ''));
  $page->breadcrumb_classes('', 'crumb1');
  
} else {
  $page->breadcrumbs('Browse', "Details");
}

// get a list of the category mappings first
$harvard_cat = Harvard_Calendar::get_categories(PATH_TO_EVENTS_CAT);

$page->content_begin();
?>
	<div class="focal ">
		<h2><?=$event->get_summary()?></h2>
	
		<ul class="nav">
			<li><?=$date_str?><br/><?=$time_of_day?></li>

                        <? if(briefLocation($event)) { ?>
 			   <li><a href="<?=mapURL(briefLocation($event))?>" class="map"><?=briefLocation($event)?></a></li>
                        <? } ?>

			<li class="description"><?=$event->get_description()?></li>
 
                        <? if(isset($event->infophone)) { ?>
 			   <li><a href="<?=phoneURL($event->infophone)?>" class="phone"><?=str_replace('-', '-&shy;', $event->infophone)?></a></li>
                        <? } ?>
                       
                        <? if(isset($event->infourl)) { ?>
                           <li><a href="<?=$event->urlize?>" class="external" target="_new"><?=$event->infourl?></a></li>
                        <? } ?>
		</ul>
	
		<p class="legend">Categorized as: 
                   <? $size = count($categories);
                      foreach($categories as $index => $category) { $last = ($size-1 == $index);
                          foreach($harvard_cat as $cat) {
								// The strings from $harvard_cat may be null-terminated, unlike the usual PHP strings, so trim before comparing.
                                if (strcmp(trim($cat->get_name()), trim($category)) == 0) {
                                     $categoryFound = $cat;
                                     break;
                              }
                             }
        ?>
                        <a href="<?=categoryURL($categoryFound)?>"><?=ucname($category)?></a><? if(!$last) { echo ","; } ?>
                   <? } ?>
                </p>
	</div>

<? $page->content_end(); ?>
