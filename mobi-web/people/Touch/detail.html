<?php
$page->title('People: Details')
     ->navbar_image('people')
     ->header('Details');


class Item {

  private $person;

  public function __construct($person) {
    $this->person = $person;
  }

  public function display($label, $field, $href=NULL, $class=NULL, $group=False, $hasLink=FALSE) {
    $displayString = "";
    foreach($this->person->getField($field) as $value) {
      $formatted_value = $value;
      if (strcmp($field, 'ou') == 0) {
        $formatted_value = str_replace('^', ' / ', $formatted_value);
      }
      $formatted_value = htmlspecialchars($formatted_value);
      $formatted_value = str_replace('$', '<br />', $formatted_value);

      $innerContents = "
      <span class=\"label\">$label</span>
      <span class=\"value\">$formatted_value</span>";
      if ($href !== NULL) {
        $innerContents = '<a href="' . $href($value) . '" class="' . $class . '">'
                       . $innerContents . '</a>';
      }

      $li = $hasLink ? '<li>' : '<li class="nolink">';
      $innerContents = $li . $innerContents . '</li>';

      if (!$group) {
        $innerContents = '<ul class="nav">' . $innerContents . '</ul>';
      }
      $displayString .= $innerContents;
    }
    echo $displayString;
  }
}

             
$item = new Item($person);

$page->content_begin();
?>
	<ul class="nav">
        <? $item->display('name', 'cn', NULL, NULL, TRUE, FALSE); ?>
        <? $item->display('title', 'title', NULL, NULL, TRUE, FALSE); ?>
        <? $item->display('dept', 'ou', NULL, NULL, TRUE, FALSE); ?>
	</ul>
	
        <? if(has_phone($person)) { ?>
          <ul class="nav">
          <? $item->display('home', 'homephone', 'phoneHREF', 'phone', TRUE, TRUE); ?>
          <? $item->display('phone', 'telephonenumber', 'phoneHREF', 'phone', TRUE, TRUE); ?>
          <? $item->display('fax', 'facsimiletelephonenumber', 'phoneHREF', 'phone', TRUE, TRUE); ?>
          </ul>
        <? } ?>

        <? $item->display('address', 'street', NULL, NULL, FALSE, FALSE); ?>
        <? $item->display('email', 'mail', 'mailHREF', 'email', FALSE, TRUE); ?>
        <? $item->display('office', 'postaladdress', 'officeURL', 'map', FALSE, TRUE); ?>

<? $page->content_end(); ?>

