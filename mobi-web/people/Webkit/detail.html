<?php
$page->title('People: Details')
     ->navbar_image('people')
     ->breadcrumbs('Search', 'Details');

class Item {
  private $person;

  public function __construct($person) {
    $this->person = $person;
  }

  public function display($label, $field, $href=NULL, $class=NULL, $group=False) {
    $displayString = "";

    foreach($this->person->getField($field) as $value) {
      // prevent phones from creating links from things that look like phone/email
      $value = str_replace('@', '@&shy;', $value);
      $value = str_replace('-', '-&shy;', $value);

      $innerContents = "
                 <div class=\"label\">$label</div>
                 <div class=\"value\">$value</div>";

      if ($href !== NULL) {
        $innerContents = '<a href="' . $href($value) . '" class="' . $class . '">'
                       . $innerContents . '</a>';
      }

      $innerContents = '<li>' . $innerContents . '</li>';

      if (!$group) {
        $innerContents = '<ul class="nav">' . $innerContents . '</ul>';
      }

      $displayString .= $innerContents;
    }
    echo $displayString;
  }
}

$item = new Item($person);

$page->content_begin();
?>
	<ul class="nav">
        <? $item->display('name', 'cn', NULL, NULL, TRUE); ?>
        <? $item->display('title', 'title', NULL, NULL, TRUE); ?>
        <? $item->display('dept', 'ou', NULL, NULL, TRUE); ?>
	</ul>
	
        <? if(has_phone($person)) { ?>
          <ul class="nav">
          <? $item->display('home', 'homephone', 'phoneHREF', 'phone', TRUE); ?>
          <? $item->display('phone', 'telephonenumber', 'phoneHREF', 'phone', TRUE); ?>
          <? $item->display('fax', 'facsimiletelephonenumber', 'phoneHREF', 'phone', TRUE); ?>
          </ul>
        <? } ?>

        <? $item->display('address', 'street', NULL, NULL, FALSE); ?>
        <? $item->display('email', 'mail', 'mailHREF', 'email', FALSE); ?>
        <? $item->display('office', 'physicaldeliveryofficename', 'mapURL', 'map', FALSE); ?>

<? $page->content_end(); ?>

